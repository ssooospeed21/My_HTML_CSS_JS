<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Blog - Админ-панель</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <img src="images/logo.png" alt="Логотип Travel Blog">
                <h1>Travel Blog</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Главная</a></li>
                    <li><a href="posts.html">Посты</a></li>
                    <li><a href="login.html" id="loginLink">Войти</a></li>
                    <li><a href="register.html" id="registerLink">Регистрация</a></li>
                    <li><a href="create-post.html" id="createPostLink" style="display:none;">Новый пост</a></li>
                    <li><a href="admin.html" id="adminLink" style="display:none;">Админка</a></li>
                    <li><a href="profile.html" id="profileLink" style="display:none;">Профиль</a></li>
                    <li><a href="#" id="logoutLink" style="display:none;" onclick="logout()">Выйти</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <h1>Административная панель</h1>
        
        <div id="adminContent" style="display:none;">
            <section class="admin-section">
                <h2>Пользователи</h2>
                <table id="usersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Имя пользователя</th>
                            <th>Email</th>
                            <th>Роль</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Пользователи будут загружены через JavaScript -->
                    </tbody>
                </table>
                
                <h3>Добавить нового пользователя</h3>
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="newUsername">Имя пользователя:</label>
                        <input type="text" id="newUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="newEmail">Email:</label>
                        <input type="email" id="newEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">Пароль:</label>
                        <input type="password" id="newPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newRole">Роль:</label>
                        <select id="newRole">
                            <option value="user">Пользователь</option>
                            <option value="author">Автор</option>
                            <option value="admin">Администратор</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Добавить</button>
                </form>
            </section>
        </div>
        
        <div id="adminAccessDenied" style="display:none;">
            <p>У вас нет прав доступа к админ-панели. Пожалуйста, войдите как администратор.</p>
            <a href="login.html" class="btn">Войти</a>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Travel Blog. Все права защищены.</p>
    </footer>

    <script src="js/auth.js"></script>
    <script>
        window.onload = function() {
            updateUI();
            
            if (hasRole('admin')) {
                document.getElementById('adminContent').style.display = 'block';
                document.getElementById('adminAccessDenied').style.display = 'none';
                renderUsers();
            } else {
                document.getElementById('adminContent').style.display = 'none';
                document.getElementById('adminAccessDenied').style.display = 'block';
            }
            
            document.getElementById('addUserForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('newUsername').value;
                const email = document.getElementById('newEmail').value;
                const password = document.getElementById('newPassword').value;
                const role = document.getElementById('newRole').value;
                
                if (register(username, password, email, role)) {
                    alert('Пользователь успешно добавлен');
                    document.getElementById('addUserForm').reset();
                    renderUsers();
                } else {
                    alert('Ошибка при добавлении пользователя');
                }
            });
        };
        
        function renderUsers() {
            const tbody = document.querySelector('#usersTable tbody');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${user.role}</td>
                    <td>
                        <button onclick="deleteUser(${user.id})" class="btn btn-danger">Удалить</button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }
        
        function deleteUser(userId) {
            if (confirm('Вы уверены, что хотите удалить этого пользователя?')) {
                users = users.filter(user => user.id !== userId);
                renderUsers();
                
                if (currentUser && currentUser.id === userId) {
                    logout();
                }
            }
        }
    </script>
</body>
</html>